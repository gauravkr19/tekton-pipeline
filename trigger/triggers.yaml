apiVersion: triggers.tekton.dev/v1alpha1
kind: TriggerTemplate
metadata:
  name: demo-app-triggertemplate
  namespace: demo-app
spec:
  params:
    - name: namespace
      description: The namespace to create the resources  
  resourcetemplates:
    - apiVersion: tekton.dev/v1beta1
      kind: PipelineRun
      metadata:
        generateName: demo-app-pipeline-run-
        namespace: $(tt.params.namespace)
      spec:
        serviceAccountName: tekton-triggers-example-sa
        pipelineRef:
          name: kaniko-pipeline
        params:
          - name: IMAGE
            value: gauravkr19/details:latest
          - name: CONTEXT
            value: /workspace/source/src/details
          - name: DOCKERFILE
            value: $(workspaces.source.path)/src/details/Dockerfile
          - name: url
            value: https://github.com/gauravkr19/tekton-pipeline.git
          - name: revision
            value: master
          - name: namespace
            description: The namespace to create the resources                        
        workspaces:
        - name: git-source
          persistentVolumeClaim:
            claimName: mypvc
        - name: dockerconfig
          secret:
            secretName: regcred            
          #
          # - name: image-source
          #   resourceSpec:
          #     type: image
          #     params:
          #       - name: url
          #         value: gauravkr19/demo-app # docker-repo-location.com/repo:demo-app
          # - name: event-to-sink
          #   resourceSpec:
          #     type: cloudEvent
          #     params:
          #       - name: targetURI
          #         value: http://event-display.demo-app.svc.cluster.local
---
apiVersion: triggers.tekton.dev/v1alpha1
kind: TriggerBinding
metadata:
  name: demo-app-pipelinebinding
  namespace: demo-app
spec:
  params:
    - name: gitrevision
      value: $(body.head_commit.id)
    - name: namespace
      value: demo-app
    - name: gitrepositoryurl
      value: "https://github.com/$(body.repository.full_name)"
---
apiVersion: triggers.tekton.dev/v1alpha1
kind: EventListener
metadata:
  name: demo-app-listener
  namespace: demo-app
spec:
  serviceAccountName: tekton-triggers-example-sa
  triggers:
    - bindings:
      - ref: demo-app-pipelinebinding
      template:
        ref: demo-app-triggertemplate
