apiVersion: triggers.tekton.dev/v1alpha1
kind: TriggerTemplate
metadata:
  name: demo-app-triggertemplate
  namespace: demo-app
spec:
  resourcetemplates:
    - apiVersion: tekton.dev/v1beta1
      kind: PipelineRun
      metadata:
        generateName: demo-app-pipeline-run-
        namespace: demo-app
      spec:
        serviceAccountName: tekton-triggers-example-sa
        pipelineRef:
          name: kaniko-pipeline
        taskRunSpecs:
          - pipelineTaskName: gke-deploy-app
            taskServiceAccountName: tf-sa-anthos-gke

        # params:
        #   - name: imageDetails
        #     value: $(params.image-registry)/details
        #   - name: contextDetails
        #     value: ./src/details
        #   - name: dockerfileDetails
        #     value: ./src/details/Dockerfile
        #   - name: imageMongodb
        #     value: $(params.image-registry)/mongodb
        #   - name: contextMongodb
        #     value: ./src/mongodb/
        #   - name: dockerfileMongodb
        #     value: ./src/mongodb/Dockerfile
        #   - name: url
        #     value: https://github.com/gauravkr19/tekton-pipeline.git
        #   - name: revision
        #     value: master                           
        workspaces:
        - name: git-source
          persistentVolumeClaim:
            claimName: mypvc
        - name: dockerconfig
          secret:
            secretName: regcred           
                        
---
apiVersion: triggers.tekton.dev/v1alpha1
kind: TriggerBinding
metadata:
  name: demo-app-pipelinebinding
  namespace: demo-app
spec:
  params:
    - name: gitrevision
      value: $(body.head_commit.id)
    - name: namespace
      value: demo-app
    - name: gitrepositoryurl
      value: "https://github.com/$(body.repository.full_name)"
---
apiVersion: triggers.tekton.dev/v1alpha1
kind: EventListener
metadata:
  name: demo-app-listener
  namespace: demo-app
spec:
  serviceAccountName: tekton-triggers-example-sa
  triggers:
    - bindings:
      - ref: demo-app-pipelinebinding
      template:
        ref: demo-app-triggertemplate
